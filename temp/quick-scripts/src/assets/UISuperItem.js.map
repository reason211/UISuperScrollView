{"version":3,"sources":["assets/UISuperItem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import UISuperLayout, { UISuperAxis } from './UISuperLayout';\nconst { ccclass, property } = cc._decorator;\n@ccclass\nexport default class UISpuerItem extends cc.Component {\n    private layout: UISuperLayout\n    private refreshItemCallback: Function\n\n    onLoad() {\n        this.node.on(cc.Node.EventType.POSITION_CHANGED, this.resetScrollView, this)\n        this.node.on(cc.Node.EventType.SCALE_CHANGED, this.resetScrollView, this)\n        this.node.on(cc.Node.EventType.SIZE_CHANGED, this.resetScrollView, this)\n    }\n    private resetScrollView() {\n        if (this.isFooter) {\n            this.layout.resetScrollView()\n        }\n    }\n    public init(layout: UISuperLayout, refreshItemCallback: Function) {\n        this.layout = layout\n        this.refreshItemCallback = refreshItemCallback\n    }\n    private get width() {\n        return this.node.width * this.layout.getUsedScaleValue(this.node.scaleX)\n    }\n    private get height() {\n        return this.node.height * this.layout.getUsedScaleValue(this.node.scaleY)\n    }\n    private get isHeader() {\n        return this.node.getSiblingIndex() == 0\n    }\n    private get isFooter() {\n        return this.node.getSiblingIndex() == this.layout.node.childrenCount - 1\n    }\n    private get isUpdateHeader() {\n        if (this.layout.startAxis == UISuperAxis.VERTICAL && this.layout.scrollView.deltaMove.y > 0 && this.isHeader) {\n            return true\n        }\n        if (this.layout.startAxis == UISuperAxis.HORIZONTAL && this.layout.scrollView.deltaMove.x < 0 && this.isHeader) {\n            return true\n        }\n        return false\n    }\n    private get isUpdateFooter() {\n        if (this.layout.startAxis == UISuperAxis.VERTICAL && this.layout.scrollView.deltaMove.y < 0 && this.isFooter) {\n            return true\n        }\n        if (this.layout.startAxis == UISuperAxis.HORIZONTAL && this.layout.scrollView.deltaMove.x > 0 && this.isFooter) {\n            return true\n        }\n        return false\n    }\n\n    private isOutOfBoundary(offset: cc.Vec2) {\n        if (this.layout.startAxis == UISuperAxis.VERTICAL && offset.y == 0) {\n            return true\n        }\n        if (this.layout.startAxis == UISuperAxis.HORIZONTAL && offset.x == 0) {\n            return true\n        }\n        return false\n    }\n\n    private relativePositionFooter(prevNode: cc.Node) {\n        if (prevNode) {\n            if (this.layout.startAxis == UISuperAxis.VERTICAL) {\n                let prevHeight = prevNode.height * this.layout.getUsedScaleValue(prevNode.scaleY)\n                let offset = (prevNode.y - (prevHeight * prevNode.anchorY)) - (this.height * (1 - this.node.anchorY)) - this.layout.spacing.y\n                this.node.y = offset\n            } else if (this.layout.startAxis == UISuperAxis.HORIZONTAL) {\n                let prevWidth = prevNode.width * this.layout.getUsedScaleValue(prevNode.scaleX)\n                let offset = prevNode.x + (prevWidth * (1 - prevNode.anchorX)) + (this.width * this.node.anchorX) + this.layout.spacing.x\n                this.node.x = offset\n            }\n        }\n    }\n    private relativePositionHeader(prevNode: cc.Node) {\n        if (prevNode) {\n            if (this.layout.startAxis == UISuperAxis.VERTICAL) {\n                let prevHeight = prevNode.height * this.layout.getUsedScaleValue(prevNode.scaleY)\n                let offset = prevNode.y + (prevHeight * (1 - prevNode.anchorY)) + (this.height * this.node.anchorY) + this.layout.spacing.y\n                this.node.y = offset\n            } else if (this.layout.startAxis == UISuperAxis.HORIZONTAL) {\n                let prevWidth = prevNode.width * this.layout.getUsedScaleValue(prevNode.scaleX)\n                let offset = prevNode.x - (prevWidth * prevNode.anchorX) - (this.width * (1 - this.node.anchorX)) - this.layout.spacing.x\n                this.node.x = offset\n            }\n        }\n    }\n    // 设置自己相对于上一个兄弟节点的位置\n    public watchBrother() {\n        let prevIndex = this.node.getSiblingIndex() - 1\n        let prevNode = this.node.parent.children[prevIndex]\n        this.relativePositionFooter(prevNode)\n    }\n    public watchSelf() {\n        // 向下填充\n        if (this.isUpdateHeader) {\n\n            let footer = this.layout.footer\n\n            let index = footer['index'] + 1\n\n            if (index == this.layout.maxItemTotal) return\n\n            let offset = this.layout.isOutOfBoundaryHeader(this.node)\n\n            if (this.isOutOfBoundary(offset)) {\n\n                this.node['index'] = index\n\n                this.refreshItemCallback(this.node, index)\n\n                this.relativePositionFooter(footer)\n                this.node.setSiblingIndex(this.layout.node.childrenCount - 1)\n            }\n        }\n        // 向上填充\n        if (this.isUpdateFooter) {\n\n            let header = this.layout.header\n\n            let index = header['index'] - 1\n\n            if (index == -1) return\n\n            let offset = this.layout.isOutOfBoundaryFooter(this.node)\n\n            if (this.isOutOfBoundary(offset)) {\n\n                this.node['index'] = index\n\n                this.node.setSiblingIndex(0)\n\n                this.refreshItemCallback(this.node, index)\n\n                this.relativePositionHeader(header)\n            }\n        }\n    }\n    update(dt) {\n        this.watchBrother()\n        this.watchSelf()\n    }\n}\n"]}